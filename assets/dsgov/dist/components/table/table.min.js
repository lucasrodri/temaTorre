import i from"../../partial/js/behavior/collapse";import o from"../../partial/js/behavior/dropdown";class H{constructor(e,t,s){this.name=e,this.component=t,this._header=this.component.querySelector(".header, .table-header"),this._table=this.component.querySelector("table"),this._sequence=s,this._setBehaviors()}_setBehaviors(){this._makeResponsiveTable(),this._headerBehavior(),this._setHeaderWidth(),this._searchBehavior(),this._dropdownBehavior(),this._collpaseBehavior(),this._densityBehavior(),this._setClickActions(),this._getBRHeaderHeight()}_getBRHeaderHeight(){const e=document.querySelector(".br-header");e&&window.addEventListener("scroll",()=>{this._header.style.top=e.clientHeight+"px"})}_makeResponsiveTable(){if(!this.component.querySelector(".responsive")){const e=document.createElement("div");e.classList.add("responsive"),e.appendChild(this._table),this._header.after(e)}}_headerBehavior(){window.addEventListener("resize",()=>{});for(const e of this.component.querySelectorAll(".responsive"))window.innerWidth}_makeScroller(){const e=document.createElement("div");e.classList.add("scroller");for(const t of this._table.querySelectorAll("thead tr th")){const s=document.createElement("div");s.classList.add("item"),s.innerHTML=t.innerHTML,t.offsetWidth&&(s.style.flex=`1 0 ${t.offsetWidth}px`),e.appendChild(s);const o=s.querySelector(".br-checkbox");if(o){const e=o.querySelector("input"),t=o.querySelector("label");e.id=e.id+"-clone",t.setAttribute("for",e.id)}}return e}_cloneHeaders(){const e=document.createElement("div");e.classList.add("headers"),e.style.top=this._header.offsetHeight+"px",e.appendChild(this._makeScroller()),this._header.after(e)}_hideThead(){this._table.style.marginTop=`-${this._table.querySelector("thead").offsetHeight}px`}_setSyncScroll(e){e.classList.add("syncscroll"),e.setAttribute("name","table-"+this._sequence),e.setAttribute("style","overflow-y: hidden")}_setHeaderWidth(){for(const e of this.component.querySelectorAll(".headers > div"))for(const[t,s]of this.component.querySelectorAll("table thead tr th").entries())e.children[t].style.flex=`1 0 ${s.offsetWidth}px`}_dropdownBehavior(){this.component.querySelectorAll('[data-toggle="dropdown"]').forEach(e=>{new o({trigger:e,iconToShow:"fa-chevron-down",iconToHide:"fa-chevron-up",useIcons:!0}).setBehavior()})}_collpaseBehavior(){this.component.querySelectorAll('[data-toggle="collapse"]').forEach(e=>{new i({trigger:e,iconToShow:"fa-chevron-down",iconToHide:"fa-chevron-up",useIcons:!0}).setBehavior()})}_searchBehavior(){if(this.component.dataset.search){const e=this.component.querySelector('[data-toggle="search"]'),t=this.component.querySelector(".search-bar"),s=this.component.querySelector('[data-dismiss="search"]');this._searchInit(e),e.addEventListener("click",()=>this._searchOpen(e,t)),s.addEventListener("click",()=>this._searchClose(e,t)),t.querySelector("input").addEventListener("keydown",s=>{"Escape"===s.key&&this._searchClose(e,t)})}}_searchInit(e){e.setAttribute("aria-expanded","false")}_searchOpen(e,t){e.setAttribute("aria-expanded","true"),t.classList.add("show"),t.parentElement.classList.add("show"),t.querySelector("input").focus()}_searchClose(e,t){t.querySelector("input").value="",t.classList.remove("show"),t.parentElement.classList.remove("show"),e.focus(),e.setAttribute("aria-expanded","false")}_densityBehavior(){const e=this.component.querySelectorAll("[data-density]");for(const t of e)t.addEventListener("click",()=>{this.component.classList.remove("small","medium","large"),this.component.classList.add(t.dataset.density),this._dropdownClose(t.closest(".dropdown").querySelector('[data-toggle="dropdown"]'))})}_setClickActions(){const e=this.component.querySelector('.headers [type="checkbox"]'),t=this.component.querySelectorAll('tbody [type="checkbox"]'),s=this.component.querySelector(".selected-bar"),o=this.component.querySelectorAll('[data-toggle="check-all"]');for(const r of o)r.addEventListener("click",()=>{this._checkAllTable(s,t,e),r.parentElement.classList.contains("br-list")&&this._dropdownClose(r.closest(".dropdown").querySelector('[data-toggle="dropdown"]'))});if(t)for(const o of t)o.addEventListener("change",()=>{this._checkRow(o,s,t,e)})}_setRow(e,t){const s=e.parentNode.parentNode.parentNode;t?(s.classList.add("is-selected"),e.parentNode.classList.add("is-inverted"),e.checked=!0):(s.classList.remove("is-selected"),e.parentNode.classList.remove("is-inverted"),e.checked=!1)}_checkRow(e,t,s,o){const r=e.checked;this._setRow(e,r),this._setSelectedBar(r?1:-1,t,s,o)}_checkAllRows(e){for(const t of e)this._setRow(t,!0)}_uncheckAllRows(e){for(const t of e)this._setRow(t,!1)}_checkAllTable(e,t,s){let o=t.length;const r=e.querySelector(".info .count");parseInt(r.innerHTML,10)===o?(this._uncheckAllRows(t),o*=-1):this._checkAllRows(t),this._setSelectedBar(o,e,t,s)}_setSelectedBar(e,t,s,o){const r=t.querySelector(".info .count"),i=t.querySelector(".info .text"),c=e<2?parseInt(r.innerHTML,10)+e:e;c>0?(t.classList.add("show"),r.innerHTML=c,i.innerHTML=c>1?"itens selecionados":"item selecionado",o&&o.parentNode.classList.add("is-checking"),c===s.length&&o&&(o.checked=!0,o.parentNode.classList.remove("is-checking"))):(r.innerHTML=0,o&&(o.checked=!1,o.parentNode.classList.remove("is-checking")),t.classList.remove("show"))}
/**
   * @fileoverview syncscroll - scroll several areas simultaniously
   * @version 0.0.3
   *
   * @license MIT, see http://github.com/asvd/intence
   * @copyright 2015 asvd <heliosframework@gmail.com>
   */
static _elSyn(e,t,s,o,r,i,c){const n="add"+r,a=Math.round;e[n](s,()=>{const o=c[t];let r=e[s+"Left"],i=e[s+"Top"];const n=r/(e[s+"Width"]-e.clientWidth),l=i/(e[s+"Height"]-e.clientHeight),d=r!==e.eX,h=i!==e.eY;e.eX=r,e.eY=i,o.forEach(t=>{t!==e&&(d&&a(t[s+"Left"]-(r=t.eX=a(n*(t[s+"Width"]-t.clientWidth))))&&(t[s+"Left"]=r),h&&a(t[s+"Top"]-(i=t.eY=a(l*(t[s+"Height"]-t.clientHeight))))&&(t[s+"Top"]=i))})},0)}}export default H;